上个月学习Peter Shirley-Ray Tracing in One Weekend的系列三本书，收获真的很多。这个系列的书真的是手把手教你如何从零开始构建一个光线跟踪渲染器，对新手（像我）非常友好。但是书中有很多章节需要有一定的数学功底才能看懂，本文想分享一下关于in One Weekend-chapter 8:Metal中一笔带过的折射公式推导，内容主要来自于《Mathematics for 3D Game Programming and Computer Graphics, 3rd Edition》[1]，加上我个人的理解，如有错误，欢迎指出。

（配图为raytracer构建后渲染)

问题简述
已知入射向量 \(L\) 和交点法线 \(N\)，和入射光线所在介质折射率 \(\eta _ { \mathrm { L } }\) 及折射光线所在介质折射率 \(\eta _ { \mathbf { T } }\) ,求折射向量 \(T\)。如图：

设入射角为 \(\theta _ { \mathrm { L } }\) ，折射角为 \(\theta _ { \mathbf { T } }\)
设 \(L\) 和 \(N\) 已经标准化为单位向量，所求 \(T\) 也为单位向量
注意此处 \(L\) 的方向指向外，保留与书上一致（实际入射方向应为\(-L\))
L、T可以理解为light和transmission的缩写


图 1

推导过程
（若推导过程感觉理解困难可以先考虑二维情况再考虑三维，其实入射光线和折射光线都在一个二维平面上）

关键公式：折射定律或斯涅尔定律(Snell's Law)，用于计算折射角 \(\theta _ { \mathbf { T } }\) :


推导思路：
将 \(T\) 分解为平行于 \(N\)(-\(N\)) 和垂直于 \(N\) 的向量 (\(-G\))，见图 1。（用这两个向量的线性组合\(a*-N+b*G\)表示 \(T\)，问题就在于求两个系数a、b和向量 \(G\)，将问题转换为求\(a\)、\(b\)、\(G\)）

1. 求 \(a\)
求\(a\)实际上就是求向量\(T\)在向量\(-N\)上的投影，利用点乘公式即可计算出\(a=\cos \theta _ { \mathrm { T } }\)，由于所求 \(T\) 和 \(-N\) 都为单位向量，所以其点乘展开式最终化简为\(\cos \theta _ { \mathrm { T } }\)。

\(T \cdot (-N) = |T| |-N| \cos \theta _ { \mathrm { T } }=\cos \theta _ { \mathrm { T } }\)

\(T \cdot (-N) = |-N|\cdotp Proj = Proj\)

联立上式即可

2. 求 \(b\)
基本思路和求 \(a\) 一样，这里求出 \(b = \sin \theta _ { \mathrm { T } }\)

(实际此处先求出的是cos<T,-G>，根据由于垂直关系，两角互余，等值于 \(\sin \theta _ { \mathrm { T } }\) )

3. 求 \(G\)
\(G\) 同 \(\operatorname { perp } _ { \mathrm { N } } \mathbf { L }\)平行（\(\operatorname { perp } _ { \mathrm { N } } \mathbf { L }\)为\(L\)垂直于\(N\)的分量，见图 1），由于 \(L\) 为单位向量，\(\left\| \operatorname { perp } _ { \mathbf { N } } \mathbf { L } \right\| = \sin \theta _ { \mathbf { L } }\)，\(G\) 可表示为:

(求 \(\operatorname { perp } _ { \mathrm { N } } \mathbf { L }\) 的过程有点像施密特正交化的过程，都是一个向量去除某个方向的分量，除以 \(\sin \theta _ { \mathbf { L } }\) 即标准化为单位向量)

4. 所以 \(T\) 可以表示为:


利用斯涅尔定律替换\(\frac { \sin \theta _ { \mathrm { T } } } { \sin \theta _ { \mathrm { L } } }\):



将 \(\cos \theta _ { \mathrm { T } }\) 用 \(\sqrt { 1 - \sin ^ { 2 } \theta _ { \mathrm { T } } }\)代替，\(\sin \theta _ { \mathrm { T } }\) 用 \(\left( \eta _ { \mathrm { L } } / \eta _ { \mathrm { T } } \right) \sin \theta _ { \mathrm { L } }\) 代替:



最后，将 \(\sin ^ { 2 } \theta _ { \mathrm { L } }\) 用 \(1 - \cos ^ { 2 } \theta _ { \mathrm { L } } = 1 - ( \mathbf { N } \cdot \mathbf { L } ) ^ { 2 }\) 带入可得最终 \(T\) 的表达式：


（如果 \(\eta _ { \mathbf { L } } > \eta _ { \mathbf { T } }\)，方程式中根号内的量可能为负，光线发生全反射，应用反射公式计算向量方向。即当 \(\sin \theta _ { \mathrm { L } } \leq \eta _ { \mathrm { T } } / \eta _ { \mathrm { L } }\)，上式才可用于计算折射向量。）

其他
最后放一张in one weekend中计算折射向量的函数，参数 v 即为入射光线方向，只要将上诉公式加以对照即可写出。（记得上述 \(-L=v\))


参考文献
Eric Lengyel. Mathematics for 3D Game Programming and Computer Graphics, 3rd Edition. Course Technology PTR, 2011.
Peter Shirley. Ray Tracing in One Weekend. Amazon Digital Services LLC, January 26, 2016.
折射向量计算(Refraction Vector Calculation）的更多相关文章
【3D数学基础】三维空间折射向量计算
问题:在三维空间中,已知折射率 e .入射角 L 和法线 N. 要求:计算出折射向量 T. 其中: L. N 和 T 都为单位向量. 如图片所示,下面所有的公式都看着这张图片来求解的: 首先,我们必须 ...

由浅入深学习PBR的原理和实现
目录 一. 前言 1.1 本文动机 1.2 PBR知识体系 1.3 本文内容及特点 二. 初阶:PBR基本认知和应用 2.1 PBR的基本介绍 2.1.1 PBR概念 2.1.2 与物理渲染的差别 2 ...

shader函数
Intrinsic Functions (DirectX HLSL) The following table lists the intrinsic functions available in HL ...

unity shader 常用函数列表
此篇博客转自csdn的一位大牛. 中间排版出了一些问题 Intrinsic Functions (DirectX HLSL) The following table lists the intrins ...

DirectX HLSL 内置函数
Intrinsic Functions (DirectX HLSL) The following table lists the intrinsic functions available in HL ...

HLSL Shader编程基础总结
转自:https://blog.csdn.net/Blues1021/article/details/47093487 基本前提概念 Shader是一种映射到GPU硬件汇编语言上的高级语言,Shade ...

【SIGGRAPH】用【有说服力的照片真实】技术实现最终幻想15的视觉特效
原文:西川善司 http://www.4gamer.net/games/075/G007535/20160726064/   最终幻想15的演讲会场.相当大,听众非常多.      在本次计算机图形和 ...

Nvidia Anisotropic Lighting
http://http.download.nvidia.com/developer/SDK/Individual_Samples/DEMOS/Direct3D9/HLSL_Aniso.zip Anis ...

Nvidia VertexTextureFetch Water
http://http.download.nvidia.com/developer/SDK/Individual_Samples/samples.html http://http.download.n ...

随机推荐
Java Web 项目简单配置 Spring MVC进行访问
所需要的 jar 包下载地址: https://download.csdn.net/download/qq_35318576/10275163 配置一: 新建 springmvc.xml 并编辑如下内 ...

Redis散列操作
Redis的散列可以将多个键值对存储在一个Redis键里面.可以把这种数据聚集看作是数据库中的行或者文档数据库中的文档. (添加和删除键值对) HMGET : HMGET key-name key [ ...

C#图片文字识别
图片识别的技术到几天已经很成熟了,只是相关的资料很少,为了方便在此汇总一下(C#实现),方便需要的朋友查阅,也给自己做个记号. 图片识别的用途:很多人用它去破解网站的验证码,用于达到自动刷票或者是批量 ...

Java基础——Servlet（三）
还在学习Servlet,觉得这里的知识点蛮多的.还要继续努力,加油. 拿韩老师的话激励一下自己,共勉.韩老师说,“成功其实也不难,只要树立一个目标,不需要你是一个很强的人,不需要你很高智商,不需要你是 ...

【Mysql】Mysql 各个版本区别
一.Mysql 各个版本区别: 1.MySQL Community Server 社区版本,开源免费,但不提供官方技术支持.这也是我们通常用的MySQL的版本.根据不同的操作系统平台细分为多个版本 2 ...

编程输出杨辉三角的前10行---多维数组的应用---java实现
import java.util.Scanner;public class yanghui{ public static void main(String[] args){  Scanner sc=n ...

POJ2778(SummerTrainingDay10-B AC自动机+矩阵快速幂)
DNA Sequence Time Limit: 1000MS   Memory Limit: 65536K Total Submissions: 17160   Accepted: 6616 Des ...

地区picker 各选择器，优劣分析
移动端选择器picker有很多,各大ui组件都有自己的picker,比如light7,HUI,MUI,jqueryUI等等.但是,我发现他们都有各种各样的问题.这次的地区选择,需要地区的省份+市+经纬 ...

js-jQuery性能优化（一）
来自于<锋利的jQuery> 1.使用最新版本的jQuery类库 jQuery每一个新的版本都会较上一版本进行BUG修复和一些优化,同时也会包含一些创新,所以建议使用最新版本的jQuery ...

drupal常用api
最短的函数 // 语言字串,除了可以获取对应语言外,还可以设置字串变量.可以是!var, @var或 %var,%var就添加元素外层.@var会过滤HTML,!var会原样输出HTML,%var会添 ...

热门专题
DJANGO VUE 动态菜单CENTOS7 IPTABLES 开放443安卓启动页面没有显示图片JAVA对象占用内存大小NGINX 怎么转发 静态文件JSJAVA的ARRAYS.SORT()方法到底用的什么排序算法ADT-BUNDLE环境搭建CONDA 还能看到已经删除了的虚拟环境,MATLAB 畸变 代码LUCKM7EC7.丨IVE/28Y2简单的VUE实现注册与登录验证NESTJS使用WEBSCOKETLINEHEIGHT对行内块有效吗ORECLE 获取当前日期是本月的多少天VUE INPUT框根据条件设置不可编辑CSS跨域 HEADERSHTML实体码编 汉字MATLAB FREQS函数用法LINUX EXPR会初始化为0吗如何用电脑读取QW文件中的SLK聊天记录
Home
Powered By WordPress